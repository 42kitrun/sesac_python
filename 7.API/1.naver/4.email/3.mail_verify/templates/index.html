<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- bootstrap css 추가 -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"> -->
    <!-- Bootstrap icon 추가 -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"> -->
</head>

<body>
    <h2>회원가입이라고 치고</h2>
    <div id="id-group">
        <label for="id">아이디:</label>
        <input type="text" name="id" id="id" required>
        <button onclick="checkId()">아이디 중복 확인</button><br>
    </div>

    <p id="id-result"><!--결과 출력할곳--></p>

    <div id="pw-group">
        <label for="pw">비밀번호:</label>
        <input type="password" name="pw" id="pw" required>

        <label for="pw2">비밀번호 확인:</label>
        <input type="password" name="pw2" id="pw2" required>
        <button onclick="checkPassword()">비밀번호 동일 확인</button><br>
    </div>

    <p id="pw-result"><!--결과 출력할곳--></p>

    <div>
        <label for="email">이메일:</label>
        <input type="email" name="email" id="email">
        <button onclick="sendCode()">인증코드 전송</button><br>
    </div>

    <div>
        <label for="code">인증코드:</label>
        <input type="text" name="code" id="code">
        <button onclick="verifyCode()">인증코드 확인</button><br>
    </div>

    <p id="email-result"><!--결과 출력할곳--></p>
    
    <button onclick="register()" id="register-btn">회원가입</button>

    <p id="registration-result"><!--결과 출력할곳--></p>

    <script>
        let idChecked = 0;
        let pwChecked = 0;
        let emailVerified = 0;

        
        document.getElementById('register-btn').disabled = idChecked * pwChecked * emailVerified;

        // 미션1. email 주소 가져다가 서버로 보내기 (/send-code)
        async function sendCode() {
            const email = document.getElementById('email').value;
            const response = await fetch('/send-code', {
                method: 'POST',
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email })
            })

            // result 에다가 "메일 전송 성공/실패 여부 출력" (서버에서 받아와서...)
            const data = await response.json();
            document.getElementById('email-result').innerText = data.message || data.error;
        }

        // 미션2. code를 가져다가 서버로 보내기 (/verify-code)
        async function verifyCode() {
            const code = document.getElementById('code').value;
            const response = await fetch('/verify-code', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code })
            })
            // result 에다가 "검증 코드 맞음/틀림 여부 출력" (서버에서 받아와서...)
            const data = await response.json();
            document.getElementById('email-result').innerText = data.message || data.error;
        }

        // checkId
        async function checkId() {
            const id = document.getElementById('id').value;
            const response = await fetch('/check-id', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id })
            })
            // result 에다가 "검증 코드 맞음/틀림 여부 출력" (서버에서 받아와서...)
            const result = await response.json();
            document.getElementById('id-result').innerText = result.message;
        }

        // checkPassword
        function checkPassword() {
            const pw = document.getElementById('pw').value;
            const pw2 = document.getElementById('pw2').value;

            const matching = pw === pw2 ? '비밀번호 확인 완료' : "비밀번호가 일치하지 않습니다";
            document.getElementById('pw-result').innerText = matching;
        }

        //register
        async function register() {
            const id = document.getElementById('id').value;
            const pw = document.getElementById('pw').value;
            const email = document.getElementById('email').value;

            const userInfo = {
                'user_id': id,
                'user_pw': pw,
                'user_email': email
            }
            
            const response = await fetch('/register-userinfo', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userInfo })
            })
            // result 에다가 "검증 코드 맞음/틀림 여부 출력" (서버에서 받아와서...)
            const result = await response.json();
            document.getElementById('registration-result').innerText = result.message;
            
        

        }

    </script>
    <!-- bootstrap js 추가 -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script> -->
</body>

</html>